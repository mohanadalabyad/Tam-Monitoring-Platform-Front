<div class="statistics-page">
  <div class="page-header">
    <h1>الإحصائيات</h1>
    <p>نظرة عامة على النظام</p>
  </div>

  <div class="stats-grid" *ngIf="!loading">
    <div class="stat-card">
      <div class="stat-icon stat-icon-primary">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
        </svg>
      </div>
      <div class="stat-content">
        <div class="stat-value">{{ totalViolations }}</div>
        <div class="stat-label">إجمالي الحوادث</div>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon stat-icon-success">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
      </div>
      <div class="stat-content">
        <div class="stat-value">{{ publishedViolations }}</div>
        <div class="stat-label">البلاغات المنشورة</div>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon stat-icon-warning">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <line x1="12" y1="8" x2="12" y2="12"/>
          <line x1="12" y1="16" x2="12.01" y2="16"/>
        </svg>
      </div>
      <div class="stat-content">
        <div class="stat-value">{{ underReviewViolations }}</div>
        <div class="stat-label">قيد المراجعة</div>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon stat-icon-info">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/>
          <circle cx="9" cy="7" r="4"/>
          <path d="M23 21v-2a4 4 0 00-3-3.87"/>
          <path d="M16 3.13a4 4 0 010 7.75"/>
        </svg>
      </div>
      <div class="stat-content">
        <div class="stat-value">{{ totalUsers }}</div>
        <div class="stat-label">إجمالي المستخدمين</div>
      </div>
    </div>
  </div>

  <div class="charts-section" *ngIf="!loading">
    <!-- Pie Chart -->
    <div class="chart-card">
      <div class="chart-header">
        <h3>توزيع البلاغات</h3>
      </div>
      <div class="pie-chart-container">
        <svg class="pie-chart" viewBox="0 0 200 200" *ngIf="pieChartData.length > 0">
          <g *ngFor="let data of pieChartData; let i = index">
            <path
              [attr.d]="getPieChartPath(i)"
              [attr.fill]="data.color"
              [attr.stroke]="'var(--white)'"
              [attr.stroke-width]="2"
              class="pie-segment"
            />
          </g>
        </svg>
        <div class="chart-legend" *ngIf="pieChartData.length > 0">
          <div *ngFor="let data of pieChartData" class="legend-item">
            <span class="legend-color" [style.background-color]="data.color"></span>
            <span class="legend-label">{{ data.label }}</span>
            <span class="legend-value">{{ data.value }} ({{ data.percentage | number:'1.1-1' }}%)</span>
          </div>
        </div>
        <div class="chart-empty" *ngIf="pieChartData.length === 0">
          <p>لا توجد بيانات للعرض</p>
        </div>
      </div>
    </div>

    <!-- Bar Chart -->
    <div class="chart-card">
      <div class="chart-header">
        <h3>مقارنة الإحصائيات</h3>
      </div>
      <div class="bar-chart-container" *ngIf="barChartData.length > 0">
        <svg class="bar-chart" viewBox="0 0 400 250">
          <g *ngFor="let data of barChartData; let i = index" class="bar-group">
            <rect
              [attr.x]="i * 120 + 20"
              [attr.y]="200 - (data.percentage * 1.5)"
              [attr.width]="80"
              [attr.height]="data.percentage * 1.5"
              [attr.fill]="data.color"
              class="bar"
              rx="4"
            />
            <text
              [attr.x]="i * 120 + 60"
              [attr.y]="195 - (data.percentage * 1.5)"
              text-anchor="middle"
              class="bar-value"
              font-size="12"
              font-weight="bold"
            >
              {{ data.value }}
            </text>
            <text
              [attr.x]="i * 120 + 60"
              [attr.y]="220"
              text-anchor="middle"
              class="bar-label"
              font-size="11"
            >
              {{ data.label }}
            </text>
          </g>
        </svg>
      </div>
      <div class="chart-empty" *ngIf="barChartData.length === 0">
        <p>لا توجد بيانات للعرض</p>
      </div>
    </div>
  </div>

  <div class="loading-state" *ngIf="loading">
    <div class="spinner"></div>
    <p>جاري تحميل الإحصائيات...</p>
  </div>
</div>
