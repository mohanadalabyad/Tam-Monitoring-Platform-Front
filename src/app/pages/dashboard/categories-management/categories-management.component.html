<div class="categories-management-page">
  <div class="page-header">
    <div>
      <h1>إدارة الفئات</h1>
      <p>إدارة فئات الانتهاكات</p>
    </div>
    <button class="btn-primary" (click)="openAddModal()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="12" y1="5" x2="12" y2="19"/>
        <line x1="5" y1="12" x2="19" y2="12"/>
      </svg>
      إضافة فئة جديدة
    </button>
  </div>

  <div class="categories-grid" *ngIf="!loading">
    <div class="category-card" *ngFor="let category of categories">
      <div class="category-header">
        <div class="category-icon" *ngIf="category.icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path [attr.d]="getIconSvg(category.icon)"/>
          </svg>
        </div>
        <div class="category-info">
          <h3>{{ category.nameAr }}</h3>
        </div>
        <div class="category-order">#{{ category.order }}</div>
      </div>
      <p class="category-description" *ngIf="category.description">{{ category.description }}</p>
      <div class="category-actions">
        <button class="btn-edit" (click)="editCategory(category)">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 20h9M16.5 3.5a2.121 2.121 0 013 3L7 19l-4 1 1-4L16.5 3.5z"/>
          </svg>
          تعديل
        </button>
        <button class="btn-delete" (click)="deleteCategory(category)">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/>
          </svg>
          حذف
        </button>
      </div>
    </div>
    <div class="empty-state" *ngIf="categories.length === 0">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="10"/>
        <line x1="12" y1="8" x2="12" y2="12"/>
        <line x1="12" y1="16" x2="12.01" y2="16"/>
      </svg>
      <p>لا توجد فئات. ابدأ بإضافة فئة جديدة.</p>
    </div>
  </div>

  <div class="loading-state" *ngIf="loading">
    <div class="spinner"></div>
    <p>جاري التحميل...</p>
  </div>

  <app-modal [show]="isModalOpen" [title]="editMode ? 'تعديل فئة' : 'إضافة فئة جديدة'" (close)="closeModal()">
      <form [formGroup]="categoryForm" class="category-form">
        <div class="form-group">
          <label for="nameAr">الاسم *</label>
          <input type="text" id="nameAr" formControlName="nameAr" placeholder="اسم الفئة"
                 [class.invalid]="categoryForm.get('nameAr')?.invalid && (categoryForm.get('nameAr')?.dirty || categoryForm.get('nameAr')?.touched)"/>
          <div class="error-message" *ngIf="categoryForm.get('nameAr')?.invalid && (categoryForm.get('nameAr')?.dirty || categoryForm.get('nameAr')?.touched)">
            الاسم مطلوب
          </div>
        </div>

        <div class="form-group">
          <label for="description">الوصف</label>
          <textarea id="description" formControlName="description" placeholder="وصف الفئة" rows="3"></textarea>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="icon">الأيقونة</label>
            <select id="icon" formControlName="icon" class="icon-select">
              <option value="">اختر أيقونة (اختياري)</option>
              <option *ngFor="let icon of availableIcons" [value]="icon.value">
                {{ icon.label }}
              </option>
            </select>
            <div class="icon-preview" *ngIf="categoryForm.get('icon')?.value">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path [attr.d]="getIconSvg(categoryForm.get('icon')?.value)"/>
              </svg>
            </div>
            <div class="icon-grid" *ngIf="!categoryForm.get('icon')?.value">
              <div 
                *ngFor="let icon of availableIcons" 
                class="icon-option"
                [class.selected]="categoryForm.get('icon')?.value === icon.value"
                (click)="categoryForm.patchValue({ icon: icon.value })"
                [title]="icon.label"
              >
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path [attr.d]="icon.svg"/>
                </svg>
                <span>{{ icon.label }}</span>
              </div>
            </div>
          </div>

          <div class="form-group">
            <label for="order">الترتيب *</label>
            <input type="number" id="order" formControlName="order" min="1"
                   [class.invalid]="categoryForm.get('order')?.invalid && (categoryForm.get('order')?.dirty || categoryForm.get('order')?.touched)"/>
            <div class="error-message" *ngIf="categoryForm.get('order')?.invalid && (categoryForm.get('order')?.dirty || categoryForm.get('order')?.touched)">
              الترتيب مطلوب ويجب أن يكون أكبر من 0
            </div>
          </div>
        </div>
      </form>
    <div footer>
      <button type="button" class="btn-secondary" (click)="closeModal()">إلغاء</button>
      <button type="button" class="btn-primary" (click)="onModalSubmit()">
        {{ editMode ? 'تحديث' : 'إضافة' }}
      </button>
    </div>
  </app-modal>
</div>
